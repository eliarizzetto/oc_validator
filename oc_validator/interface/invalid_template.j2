<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Validation Report</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
              rel="stylesheet">
        <style>
{{ style }}
        </style>
</head>
<body>
<div class="container-fluid general-info">
<h4>Validation Results</h4>
<p>
There are <strong>{{ error_count }}</strong> errors/warnings in the table submitted for validation.
</p>
<p>
The parts of the table that did not validate are marked by an underlining and immediately followed by a coloured square.
Data involving an <span style="text-decoration: underline; text-decoration-color: LightCoral">Error</span>
is marked by a red underline, data involving a
<span style="text-decoration: underline; text-decoration-color: Orange">Warning</span> is marked by an orange underline.
</p>
<p>
Each single coloured square represents the association between an Error/Warning and a single piece of data.
Squares of the same colour all represent the same error instance.
</p>
<p>
To get an explanation of an Error/Warning, hover with the mouse cursor over any of the squares that represent it.
If you click on it, all the data involved in the Error/Warning will be highlighted.
</p>
</div>

<div class="table-container container-fluid">
<table id="table-data" class="table table-bordered table-sm">
<thead class="table-light">

<tr>
<th>#</th>
{% for field in data[0].fields.keys() %}<th>{{ field }}</th>{% endfor %}
</tr>
</thead>
<tbody>
{% for modeled_row in data %}
<tr id="row{{ modeled_row.row_idx }}" class="data-row {{ 'invalid-row' if modeled_row.contains_error else 'valid-row' }}">
<td class="row-number">{{ modeled_row.row_idx }}</td>
{%- for field_key, items_in_field in modeled_row.fields.items() -%}
<td class="field-value {{ field_key }}">
{%- for item_obj in items_in_field -%}
<span id="{{ item_obj.item_id }}" class="item-container">
<span class="item-data">{{ item_obj.raw |e}}</span>
{%- for err_id in item_obj.issues -%}
{# Object representing the issue (colored square) #}
<span id="{{ err_id }}" class="issue-icon {{ errors[err_id]['level'] }} {{ errors[err_id]['label']|e }}" style="background-color: {{ errors[err_id]['color'] }}" data-bs-toggle="popover" data-bs-trigger="hover focus" data-bs-content="{{ errors[err_id]['message']|e }}" onclick="highlightInvolvedElements(this)"></span>
{%- endfor -%}
{%- if not loop.last and item_separators.get(field_key) is not none -%}
<span class="sep">{{ item_separators[field_key] if not loop.last }}</span>
{%- endif -%}
</span>
{%- endfor -%}
</td>
{%- endfor -%}
</tr>
{% endfor %}
</tbody>
</table>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
{{ script }}
</script>
</body>
</html>
